# Generic Settings
version: '{build}-{branch}'
max_jobs: 1
clone_depth: 1

# Build Image & Environment
platform: x64

matrix:
  fast_finish: true

environment:
  global: 
    CURL_VERSION: 7.56.1
    CEF_VERSION: 3.3440.1805.gbe070f9
    APPVEYOR_YML_DISABLE_PS_LINUX: true
  matrix:
  - APPVEYOR_BUILD_WORKER_IMAGE: "Visual Studio 2017"
    CMAKE_GENERATOR: "Visual Studio 15 2017"
    CMAKE_SYSTEM_VERSION: "10.0.17134.0"
    CMAKE_EXTRA_FLAGS: -DBUILD_CAPTIONS=true -DCOMPILE_D3D12_HOOK=true
    OBS_DEPS_URL: https://obsproject.com/downloads/dependencies2017.zip
    QT_PATH: "C:/Qt/5.12/msvc2017"
    VERSION_OVERRIDE: "0.0.0.0-vs2017"
  - APPVEYOR_BUILD_WORKER_IMAGE: "Visual Studio 2019 Preview"
    CMAKE_GENERATOR: "Visual Studio 16 2019"
    CMAKE_SYSTEM_VERSION: "10.0.17134.0"
    CMAKE_EXTRA_FLAGS: -DBUILD_CAPTIONS=true -DCOMPILE_D3D12_HOOK=true
    OBS_DEPS_URL: https://obsproject.com/downloads/dependencies2017.zip
    QT_PATH: "C:/Qt/5.12/msvc2017"
    VERSION_OVERRIDE: "0.0.0.0-vs2019"
 
cache:
- deps.zip
- vlc.zip

install:
- git submodule update --init --recursive
- cmd: CI/install-win.cmd
  
build_script:
- cmd: node ./CI/builder.js

test: off

artifacts:
- path: build32/*.7z
- path: build64/*.7z

deploy:
- provider: GitHub
  auth_token:
    secure: vushyTq6uZybHo5y1EFXQ4Ze6RSGF8TeKWjpQavc20MJRYHCZcIyc55BmY2Cfc7z
  draft: true
  force_update: true
  on:
    appveyor_repo_tag: true

notifications:
- provider: Webhook
  url:
    secure: PTtt5ALhmK0q42jYyx4/Qa1Uf18+gLMXKGdzJjDISJsLoTbnbjJs20iYKkdkXzjCxz4P+OtNsDAlcvpt22zFFaDx+DKfX3WrKdupfw3uW+DJzaIkFZ1njl4NRC3v2ZieNekM6fFm0uoql9sz13hWQ/XKfmq2WQf6hHJ9rO1FluU=
  method: POST
  body: >-
    {
      "content": "**Build {{status}}**: {{buildUrl}}\n[{{commitId}}] {{commitMessage}}\nBy {{commitAuthor}} on {{commitDate}}"
    }
  on_build_success: true
  on_build_failure: true
  on_build_status_changed: true
